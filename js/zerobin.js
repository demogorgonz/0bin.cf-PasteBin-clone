function secondsToHuman(e){if(60>e){var t=Math.floor(e);return t+" second"+(t>1?"s":"")}if(3600>e){var t=Math.floor(e/60);return t+" minute"+(t>1?"s":"")}if(86400>e){var t=Math.floor(e/3600);return t+" hour"+(t>1?"s":"")}if(5184e3>e){var t=Math.floor(e/86400);return t+" day"+(t>1?"s":"")}var t=Math.floor(e/2592e3);return t+" month"+(t>1?"s":"")}function hashToParameterString(e){var t="";for(key in e)""===t?(t=encodeURIComponent(key),t+="="+encodeURIComponent(e[key])):(t+="&"+encodeURIComponent(key),t+="="+encodeURIComponent(e[key]));return t+="&p=p"}function parameterStringToHash(e){for(var t={},n=e.split("&"),s=0;s<n.length;s++){var o=n[s].split("="),i=decodeURIComponent(o[0]),a=decodeURIComponent(o[1]);t[i]=a}return t}function getParameterHash(){var e=window.location.href.indexOf("#");return e>=0?parameterStringToHash(window.location.href.substring(e+1)):{}}function compress(e){return Base64.toBase64(RawDeflate.deflate(Base64.utob(e)))}function decompress(e){return Base64.btou(RawDeflate.inflate(Base64.fromBase64(e)))}function zeroCipher(e,t){return sjcl.encrypt(e,compress(t))}function zeroDecipher(e,t){return decompress(sjcl.decrypt(e,t))}function scriptLocation(){var e=window.location.href.substring(0,window.location.href.length-window.location.search.length-window.location.hash.length),t=e.indexOf("#");return-1!==t&&(e=e.substring(0,t)),e}function pasteID(){return window.location.search.substring(1)}function htmlEntities(e){return String(e).replace(/&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function setElementText(e,t){if($("div#oldienotice").is(":visible")){var n=htmlEntities(t).replace(/\n/gi,"\r\n<br>");e.html("<pre>"+n+"</pre>")}else e.text(t)}function applySyntaxColoring(){"<pre><code>"!=$("div#cleartext").html().substring(0,11)&&$("div#cleartext").html("<pre><code>"+$("div#cleartext").html()+"</code></pre>"),hljs.highlightBlock(document.getElementById("cleartext")),$("div#cleartext").css("padding","0")}function displayMessages(e,t){try{var n=zeroDecipher(e,t[0].data)}catch(s){return $("div#cleartext").hide(),$("button#clonebutton").hide(),void showError("Could not decrypt data (Wrong key ?)")}if(setElementText($("div#cleartext"),n),urls2links($("div#cleartext")),t[0].meta.syntaxcoloring&&applySyntaxColoring(),t[0].meta.expire_date&&$("div#remainingtime").removeClass("foryoureyesonly").text("This document will expire in "+secondsToHuman(t[0].meta.remaining_time)+".").show(),t[0].meta.burnafterreading&&($("div#remainingtime").addClass("foryoureyesonly").text("FOR YOUR EYES ONLY.  Don't close this window, this message can't be displayed again.").show(),$("button#clonebutton").hide()),t[0].meta.opendiscussion){$("div#comments").html("");for(var o=1;o<t.length;o++){var i=t[o],n="[Could not decrypt comment ; Wrong key ?]";try{n=zeroDecipher(e,i.data)}catch(s){}var a=$("div#comments"),r="div#comment_"+i.meta.parentid;$(r).length&&(a=$(r));var d=$('<div class="comment" id="comment_'+i.meta.commentid+'"><div class="commentmeta"><span class="nickname"></span><span class="commentdate"></span></div><div class="commentdata"></div><button onclick="open_reply($(this),\''+i.meta.commentid+"');return false;\">Reply</button></div>");setElementText(d.find("div.commentdata"),n),urls2links(d.find("div.commentdata")),d.find("span.nickname").html("<i>(Anonymous)</i>");try{d.find("span.nickname").text(zeroDecipher(e,i.meta.nickname))}catch(s){}d.find("span.commentdate").text("  ("+new Date(1e3*i.meta.postdate).toString()+")").attr("title","CommentID: "+i.meta.commentid),i.meta.vizhash&&d.find("span.nickname").before('<img src="'+i.meta.vizhash+'" class="vizhash" title="Anonymous avatar (Vizhash of the IP address)" />'),a.append(d)}$("div#comments").append('<div class="comment"><button onclick="open_reply($(this),\''+pasteID()+"');return false;\">Add comment</button></div>"),$("div#discussion").show()}}function open_reply(e,t){$("div.reply").remove(),e.after('<div class="reply"><input type="text" id="nickname" title="Optional nickname..." value="Optional nickname..." /><textarea id="replymessage" class="replymessage" cols="80" rows="7"></textarea><br><button id="replybutton" onclick="send_comment(\''+t+'\');return false;">Post comment</button><div id="replystatus">&nbsp;</div></div>'),$("input#nickname").focus(function(){$(this).css("color","#000"),$(this).val()==$(this).attr("title")&&$(this).val("")}),$("textarea#replymessage").focus()}function send_comment(e){if(0!=$("textarea#replymessage").val().length){showStatus("Sending comment...",spin=!0);var t=zeroCipher(pageKey(),$("textarea#replymessage").val()),n="",s=$("input#nickname").val();""!=s&&"Optional nickname..."!=s&&(n=zeroCipher(pageKey(),s));var o={data:t,parentid:e,pasteid:pasteID(),nickname:n};$.post(scriptLocation(),o,"json").error(function(){showError("Comment could not be sent (serveur error or not responding).")}).success(function(e){0==e.status?(showStatus("Comment posted."),location.reload()):showError(1==e.status?"Could not post comment: "+e.message:"Could not post comment.")})}}function send_data(){if(0!=$("textarea#message").val().length){if(!sjcl.random.isReady())return showStatus("Sending paste (Please move your mouse for more entropy)...",spin=!0),void sjcl.random.addEventListener("seeded",function(){send_data()});showStatus("Sending paste...",spin=!0);var e=sjcl.codec.base64.fromBits(sjcl.random.randomWords(8,0),0),t=zeroCipher(e,$("textarea#message").val()),n={data:t,expire:$("select#pasteExpiration").val(),burnafterreading:$("input#burnafterreading").is(":checked")?1:0,opendiscussion:$("input#opendiscussion").is(":checked")?1:0,syntaxcoloring:$("input#syntaxcoloring").is(":checked")?1:0};$.post(scriptLocation(),n,"json").error(function(){showError("Data could not be sent (serveur error or not responding).")}).success(function(t){if(0==t.status){stateExistingPaste();var n=scriptLocation()+"?"+t.id+"#"+e,s=scriptLocation()+"?pasteid="+t.id+"&deletetoken="+t.deletetoken;showStatus(""),$("div#pastelink").html('Your paste is <a id="pasteurl" href="'+n+'">'+n+'</a> <span id="copyhint">(Hit CTRL+C to copy)</span>'),$("div#deletelink").html('<a href="'+s+'">Delete link</a>'),$("div#pasteresult").show(),selectText("pasteurl"),setElementText($("div#cleartext"),$("textarea#message").val()),urls2links($("div#cleartext")),$("input#syntaxcoloring").is(":checked")&&applySyntaxColoring(),showStatus("")}else showError(1==t.status?"Could not create paste: "+t.message:"Could not create paste.")})}}function selectText(e){var t,n,s=document,o=s.getElementById(e);s.body.createTextRange?(t=s.body.createTextRange(),t.moveToElementText(o),t.select()):window.getSelection&&(n=window.getSelection(),t=s.createRange(),t.selectNodeContents(o),n.removeAllRanges(),n.addRange(t))}function stateNewPaste(){$("button#sendbutton").show(),$("button#clonebutton").hide(),$("button#rawtextbutton").hide(),$("div#expiration").show(),$("div#remainingtime").hide(),$("div#burnafterreadingoption").show(),$("div#opendisc").show(),$("div#syntaxcoloringoption").show(),$("button#newbutton").show(),$("div#pasteresult").hide(),$("textarea#message").text(""),$("textarea#message").show(),$("div#cleartext").hide(),$("div#message").focus(),$("div#discussion").hide()}function stateExistingPaste(){$("button#sendbutton").hide(),$("div#oldienotice").is(":visible")?$("button#clonebutton").hide():$("button#clonebutton").show(),$("button#rawtextbutton").show(),$("div#expiration").hide(),$("div#burnafterreadingoption").hide(),$("div#opendisc").hide(),$("div#syntaxcoloringoption").hide(),$("button#newbutton").show(),$("div#pasteresult").hide(),$("textarea#message").hide(),$("div#cleartext").show()}function rawText(){var e=$("div#cleartext").html(),t=document.open("text/html","replace");t.write("<pre>"+e+"</pre>"),t.close()}function clonePaste(){stateNewPaste(),history.replaceState(document.title,document.title,scriptLocation()),showStatus(""),$("textarea#message").text($("div#cleartext").text())}function newPaste(){stateNewPaste(),showStatus(""),$("textarea#message").text("")}function showError(e){$("div#status").addClass("errorMessage").text(e),$("div#replystatus").addClass("errorMessage").text(e)}function showStatus(e,t){if($("div#replystatus").removeClass("errorMessage"),$("div#replystatus").text(e),!e)return void $("div#status").html("&nbsp;");if(""==e)return void $("div#status").html("&nbsp;");if($("div#status").removeClass("errorMessage"),$("div#status").text(e),t){var n='<img src="img/busy.gif" style="width:16px;height:9px;margin:0px 4px 0px 0px;" />';$("div#status").prepend(n),$("div#replystatus").prepend(n)}}function urls2links(e){var t=/((http|https|ftp):\/\/[\w?=&.\/-;#@~%+-]+(?![\w\s?&.\/;#~%"=-]*>))/gi;e.html(e.html().replace(t,'<a href="$1" rel="nofollow">$1</a>'));var t=/((magnet):[\w?=&.\/-;#@~%+-]+)/gi;e.html(e.html().replace(t,'<a href="$1">$1</a>'))}function pageKey(){var e=window.location.hash.substring(1);return i=e.indexOf("="),i>-1&&(e=e.substring(0,i+1)),i=e.indexOf("&"),i>-1&&(e=e.substring(0,i)),"="!==e.charAt(e.length-1)&&(e+="="),e}sjcl.random.startCollectors(),$(function(){if($("input#burnafterreading").change(function(){$(this).is(":checked")?($("div#opendisc").addClass("buttondisabled"),$("input#opendiscussion").attr({checked:!1}),$("input#opendiscussion").attr("disabled",!0)):($("div#opendisc").removeClass("buttondisabled"),$("input#opendiscussion").removeAttr("disabled"))}),$("div#status").text().length>0)return void showStatus($("div#status").text(),!1);if($("div#status").html("&nbsp;"),$("div#cipherdata").text().length>1){if(0==window.location.hash.length)return void showError("Cannot decrypt paste: Decryption key missing in URL (Did you use a redirector or an URL shortener which strips part of the URL ?)");var e=jQuery.parseJSON($("div#cipherdata").text());stateExistingPaste(),displayMessages(pageKey(),e)}else $("div#errormessage").text().length>1?showError($("div#errormessage").text()):newPaste()});
